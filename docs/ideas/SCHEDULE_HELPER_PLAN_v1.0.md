# 스케줄 도우미 기능 기획서 v1.0

> 도메인별 AI 스케줄 자동 생성 도우미 시스템
> 작성일: 2026-02-19 | 버전: 1.0

---

## 개요

사용자가 도우미 카테고리를 선택하면 AI가 해당 분야에 최적화된 스케줄을 자동 생성하는 기능.
기존 채팅 기반 UX와 GPT-4o-mini 인프라를 활용하여 "대화형 스케줄 설계"를 제공한다.

**핵심 가치**
- 스케줄 작성 진입장벽 제거 — "운동 스케줄 짜줘" 한마디로 완성
- 도메인 전문성 — 분야별 최적화된 시간 배분과 루틴 제안
- 지속적 개선 — 사용자 피드백 반영하여 스케줄 자동 조정

---

## 도우미 종류

### Phase 1 — MVP (일상 도우미)

| ID | 도우미 | 설명 | 우선순위 |
|----|--------|------|----------|
| H01 | 일상 도우미 | 기상, 식사, 루틴, 취침 등 하루 생활 패턴 | **MVP** |

### Phase 2 — 확장 도우미

| ID | 도우미 | 설명 | 우선순위 |
|----|--------|------|----------|
| H02 | 운동 도우미 | 운동 종목, 세트, 휴식일, 체력 수준별 계획 | 높음 |
| H03 | 학습 도우미 | 과목별 시간 배분, 복습 주기, 시험 대비 | 높음 |
| H04 | 업무 도우미 | 태스크 블록, 집중 시간대, 마감 관리 | 보통 |

### Phase 3 — 고도화 도우미

| ID | 도우미 | 설명 | 우선순위 |
|----|--------|------|----------|
| H05 | 다이어트 도우미 | 식단 + 운동 통합 스케줄, 칼로리 추적 | 나중에 |
| H06 | 육아 도우미 | 수유, 낮잠, 놀이, 병원 일정 | 나중에 |
| H07 | 커스텀 도우미 | 사용자가 직접 도메인/규칙 정의 | 나중에 |

---

## MVP 상세 설계 — 일상 도우미 (H01)

### 사용자 플로우

```
1. 채팅에서 "일상 스케줄 짜줘" 입력
   └─ 또는 도우미 선택 UI에서 "일상 도우미" 클릭

2. 온보딩 질문 (3~5개)
   ├─ "몇 시에 일어나세요?" → 예: 7시
   ├─ "몇 시에 주무세요?" → 예: 23시
   ├─ "식사 시간은 규칙적인가요?" → 예/아니오
   ├─ "출근/등교 시간이 있나요?" → 예: 9시
   └─ "꼭 넣고 싶은 루틴이 있나요?" → 예: 운동, 독서

3. AI가 하루 스케줄 생성 (채팅에 카드 목록으로 표시)
   ├─ 07:00 기상
   ├─ 07:30 아침 식사
   ├─ 09:00 출근/등교
   ├─ 12:00 점심 식사
   ├─ 18:00 퇴근
   ├─ 19:00 저녁 식사
   ├─ 20:00 운동
   ├─ 21:00 독서
   └─ 23:00 취침

4. 사용자 확인/수정
   ├─ "전체 등록" → 일괄 Firestore 저장
   ├─ 개별 카드 수정 → "운동 시간 30분 뒤로"
   └─ "다시 짜줘" → 재생성
```

### 온보딩 데이터 구조

```javascript
// src/services/helperProfile.js
const dailyProfile = {
  helperId: 'H01',
  userId: 'uid',
  preferences: {
    wakeUp: '07:00',        // 기상 시간
    bedTime: '23:00',       // 취침 시간
    meals: {
      breakfast: '07:30',
      lunch: '12:00',
      dinner: '19:00',
      regular: true          // 규칙적 여부
    },
    commute: {
      hasCommute: true,
      startTime: '09:00',
      endTime: '18:00'
    },
    routines: ['운동', '독서']  // 사용자 추가 루틴
  },
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

### GPT 프롬프트 설계

```
[시스템 프롬프트]
너는 일상 스케줄 설계 전문가야.
사용자 정보를 바탕으로 하루 스케줄을 JSON 배열로 생성해.
규칙:
- 기상~취침 사이에 빈 시간 없이 배분
- 식사 시간은 최소 30분 확보
- 루틴 활동은 적절한 시간대에 배치 (운동→저녁 전후, 독서→취침 전)
- 이동/준비 시간 15~30분 버퍼 포함

[사용자 프롬프트]
기상: 07:00, 취침: 23:00
식사: 아침 07:30, 점심 12:00, 저녁 19:00
출퇴근: 09:00~18:00
추가 루틴: 운동, 독서

[응답 형식]
{
  "action": "create_batch",
  "events": [
    { "title": "기상", "startTime": "07:00", "endTime": "07:30", "category": "일상" },
    ...
  ]
}
```

### 신규 액션 타입

| 액션 | 설명 | 카드 색상 |
|------|------|-----------|
| `create_batch` | 다건 스케줄 일괄 생성 | 초록색 (green) |

기존 `create` (단건) 외에 `create_batch` 액션을 추가하여 여러 이벤트를 한 번에 확인/등록할 수 있게 한다.

### 필요한 파일 변경

| 파일 | 변경 내용 | 난이도 |
|------|----------|--------|
| `src/services/openai.js` | 도우미별 시스템 프롬프트 분기, `create_batch` 파싱 | 보통 |
| `src/services/schedule.js` | `addBatchEvents()` 일괄 저장 함수 추가 | 쉬움 |
| `src/services/helperProfile.js` | **신규** — 도우미 프로필 CRUD | 보통 |
| `src/components/ChatInterface.jsx` | 온보딩 플로우 UI, 배치 카드 렌더링 | 보통 |
| `src/components/HelperSelector.jsx` | **신규** — 도우미 선택 UI | 쉬움 |
| `src/components/BatchConfirmCard.jsx` | **신규** — 다건 확인 카드 컴포넌트 | 보통 |

---

## 장기 로드맵

### Phase 2: 운동 도우미 (H02) + 학습 도우미 (H03)

**운동 도우미 추가 온보딩 항목**:
- 운동 목표 (체력 증진 / 다이어트 / 근력 / 유연성)
- 운동 경험 수준 (입문 / 초급 / 중급 / 고급)
- 가능한 요일과 시간대
- 선호 운동 종류 (헬스, 러닝, 홈트, 요가 등)
- 부상/제한 사항

**운동 도우미 생성 예시**:
```
월: 상체 웨이트 (60분) → 가슴/어깨/삼두
화: 유산소 (30분) → 러닝
수: 하체 웨이트 (60분) → 스쿼트/레그프레스
목: 휴식
금: 전신 운동 (45분) → 서킷 트레이닝
토: 유산소 (40분) → 자전거/수영
일: 스트레칭/요가 (30분)
```

**학습 도우미 추가 온보딩 항목**:
- 학습 과목 목록과 우선순위
- 시험/마감일
- 하루 가용 학습 시간
- 선호 학습 방식 (집중형 / 분산형)
- 취약 과목

**학습 도우미 생성 예시**:
```
09:00~10:30  수학 (집중 과목, 오전 배치)
10:30~10:45  휴식
10:45~12:00  영어 독해
13:00~14:00  과학 복습
14:00~14:15  휴식
14:15~15:30  수학 문제풀이 (이중 배치)
```

### Phase 3: 반복 스케줄 시스템

현재 이벤트 스키마에는 반복(recurrence) 필드가 없다. 장기적으로 도우미가 생성한 스케줄을 주간/월간 반복하려면 반복 시스템이 필요하다.

**반복 이벤트 스키마 확장**:
```javascript
{
  // 기존 필드 유지
  ...existingEvent,

  // 반복 관련 신규 필드
  recurrence: {
    type: 'none' | 'daily' | 'weekly' | 'monthly' | 'custom',
    interval: 1,              // 매 N주/N일마다
    daysOfWeek: [1, 3, 5],    // 월, 수, 금 (0=일요일)
    endDate: Timestamp | null, // 반복 종료일 (null=무한)
    exceptions: ['2026-03-01'] // 예외 날짜
  },
  recurrenceGroupId: 'rg_xxx' // 반복 그룹 식별자
}
```

**캘린더 뷰 변경사항**:
- 반복 이벤트 아이콘 표시 (🔄)
- "이 일정만 수정" vs "이후 모든 일정 수정" 선택지
- 반복 일정 드래그 시 단건/전체 이동 선택

### Phase 4: 스마트 조정 시스템

**충돌 감지**:
- 도우미 스케줄 생성 시 기존 일정과 시간 겹침 자동 확인
- 겹치는 시간대 하이라이트 + 대안 시간 자동 제안

**적응형 스케줄링**:
- 사용자가 반복적으로 무시하는 스케줄 자동 감지
- "최근 2주간 아침 운동을 3번 건너뛰셨어요. 저녁으로 옮길까요?" 제안
- 완료율 통계 기반 스케줄 최적화

**도우미 간 연동**:
- 일상 도우미 + 운동 도우미 동시 사용 시 시간 자동 조율
- "운동은 저녁 식사 전에 배치" 같은 크로스 도우미 규칙

### Phase 5: 고도화

| 기능 | 설명 |
|------|------|
| 완료 추적 | 스케줄 항목별 완료/미완료 체크, 달성률 대시보드 |
| 주간 리포트 | "이번 주 운동 4회 달성 (목표 5회)" AI 요약 |
| 템플릿 공유 | 인기 스케줄 템플릿을 커뮤니티에 공유 |
| 외부 연동 | Google Calendar, Apple Calendar 양방향 동기화 |
| AI 인격 연동 | AI_PERSONA_FEATURE와 결합 — "아이돌이 운동 스케줄 짜줌" |

---

## 기술 의사결정

### 템플릿 vs 완전 AI 생성

| 방식 | 장점 | 단점 |
|------|------|------|
| **완전 AI 생성** | 유연함, 개인화 높음 | API 비용, 응답 시간, 품질 불안정 |
| **템플릿 + AI 커스터마이징** | 빠른 응답, 일관된 품질, 비용 절약 | 유연성 제한 |
| **하이브리드 (MVP 채택)** | 기본 템플릿 제공 + AI가 사용자 정보로 조정 | 구현 복잡도 약간 증가 |

**MVP 결정**: 하이브리드 방식 — 도우미별 기본 시간 템플릿을 두고, GPT가 사용자 온보딩 정보에 맞게 시간/내용을 조정

### 데이터 저장 위치

| 데이터 | 저장소 | 이유 |
|--------|--------|------|
| 도우미 프로필 | Firestore `helperProfiles/{userId}` | 사용자별 선호도, 재사용 필요 |
| 생성된 스케줄 | 기존 `events` 컬렉션 | 캘린더 뷰 호환, 기존 로직 재활용 |
| 도우미 템플릿 | 로컬 JSON | 변경 빈도 낮음, API 호출 불필요 |

---

## MVP 구현 계획

### 예상 작업량

| 단계 | 작업 | 예상 난이도 |
|------|------|------------|
| 1 | 도우미 선택 UI (HelperSelector) | 쉬움 |
| 2 | 온보딩 플로우 (ChatInterface 확장) | 보통 |
| 3 | 일상 도우미 GPT 프롬프트 설계 | 보통 |
| 4 | `create_batch` 액션 처리 로직 | 보통 |
| 5 | BatchConfirmCard 컴포넌트 | 보통 |
| 6 | `addBatchEvents()` 일괄 저장 | 쉬움 |
| 7 | 기존 스케줄 충돌 감지 (기본) | 보통 |
| 8 | 테스트 및 다듬기 | 보통 |

### MVP 완료 기준

- [ ] 채팅에서 "일상 스케줄 짜줘" 입력 시 온보딩 질문 시작
- [ ] 온보딩 완료 후 하루 스케줄 카드 목록 표시
- [ ] "전체 등록" 클릭 시 Firestore에 일괄 저장
- [ ] 캘린더에서 생성된 스케줄 확인 가능
- [ ] 개별 카드 수정/삭제 가능
- [ ] 기존 일정과 시간 겹침 경고 표시

---

## 관련 문서

- [AI 인격 부여 기능](AI_PERSONA_FEATURE_v1.0.md) — Phase 5에서 연동 예정
- [개선 아이디어](IMPROVEMENT_IDEAS_v1.1.md) — A카테고리(AI 기능 강화)와 연관

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2026-02-19 | 최초 작성 — MVP(일상 도우미) + 장기 로드맵 |
